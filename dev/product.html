<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/product.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
</head>
<body>
    @@include("./app/header.html")
    
    <!--動畫-->
    <div class="pro-out">
        
        <div class="pro-back pro-back-animate">
        
        </div>

    </div>
    <!--內容-->
    <div class="content" id="content">
        <div class="breadcrumb">
            <ol class="breadcrumb_list xsfont">
              <li><a href="./door.html">SHOP</a></li>
              <li><a href="./light-lips.html">LIPSTICK</a></li>
              <li><a href="#">水潤光澤系列</a></li>
            </ol>
        </div>
        <div class="pro-block">

        
        <section class="pro1">
            <div class="pro1_content">
                <div class="pro_text">
                    <h2 class="lfont">{{this.products[0].SER_NAME}}</h2>
                    <p class="xsfont">{{this.products[0].SER_TEXT}}
                    </p>
                </div>
                <div class="pro_pic" id="pro_pic">
                    <!--商品欄位-->
                    <div class="pro_img" v-for="(item, index) in products">
                        <img :src="item.PRO_IMG" alt="" :id="[`pro` + item.PRO_NO]" @click="proClick" :data-num="index">
                    </div>
                    
                   
                </div>
            </div>
            
        </section>
        <section class="pro2">
            <div class="pro2_content">
                <!-- 商品輪播圖 -->
                <div class="box">
                    <div class="box_img">
                        <img :src="proImgs[0]" alt="" id="box_img">
                    </div>
                    <div class="pro_btn">
                        <div class="pro_btn_top pro_btn_c" data-control="last" @click="goPic">
                            <img :src="proImgs[0]" alt="">
                        </div>
                        <div class="pro_btn_down pro_btn_c" data-control="next" @click="goPic">
                            <img :src="proImgs[1]" alt="">
                        </div>
                    </div>
                </div>
                <div class="pro_top">
                    <!-- 商品號 -->
                    <form class="pro_color">
                        <select name="" v-model="selected" @change="colorChange">
                            <option v-for="(item, index) in products" v-if="item != ''" :value="item.PRO_COLOR" :data-color="index">{{item.PRO_COLOR}}</option>
                            
                        </select>
                    </form>
                    <!-- 商品數量 -->
                    <form class="pro_number">
                        <select name="" id="" v-model="proNum">
                            <option v-for="n in 9" :data-num="n">{{n}}</option>
                            
                        </select>
                    </form>

                    <div class="por_price">
                        <h3 class="lfont">$ {{totalPrice}}</h3>
                    </div>
                </div>
                <div class="pro_down">
                    <button class="addcart">ADD TO CART</button>
                    <div class="test_color">
                        <a class="mfont" href="./makeUp.html">口紅試色</a>
                    </div>
                </div>
            </div>
                
            
        </section>
        </div>
        <div class="lag-content" v-for="(item, index) in proMessage">
            <div class="lag-pic">
                <div class="lag-pic-img">
                    <span>
                        <img src="./image/menu1.jpg">
                    </span>
                </div>
    
            </div>
            <div class="lag-val">
                <div class="lag-id">丁莉</div>
                <div class="lag-time">{{item.MES_DATE}}</div>
    
            </div>
            <div class="lag-ent">
                <div class="ent-content">
                    {{item.MES_TEXT}}
                </div>
                
            </div>
            
        </div>
        
        <div class="lag-type">
            <form method="POST">
                <textarea class="lag-type-content" id="procomment"></textarea>
                <!-- <input type="text" class="lag-type-content" placeholder="商品留言"> -->
                <button class="lag-type-btn"  @click="passcomment">留言</button>
            </form>
            <!-- <button class="lag-type-btn"  @click="passcomment">留言</button> -->
        </div>    
        
        
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js"></script>
    <script>

        let proBack = document.querySelector(".pro-out");
        setTimeout(function(){
            proBack.style.display = "none";

        },2000);

        const app = new Vue({
            el: '#content',
            data: {
                products: [],
                series: '',
                proPrice: '', //商品單價
                selected: '', //商品色票
                proNum: '', //商品數量
                proImgs: '', //圖片編號
                proMessage: '',
                // n:1,
            },
            methods: {
                proClick(e) {
                    let i = e.target.dataset.num
                    // console.log(this.products[i].PRO_PRICE)
                    //改變商品價格
                    this.proPrice = this.products[i].PRO_PRICE
                    //改變色票編號
                    this.selected = this.products[i].PRO_COLOR
                    //改變圖片編號
                    
                    this.proImgs = this.products[i].PRO_IMGS.split("|")

                },
                colorChange(e) {
                    
                    // console.log(e.target.childNodes)
                    for(let i=0; i<e.target.childNodes.length; i++){
                        if(e.target.childNodes[i].selected == true){
                            this.proPrice = this.products[i].PRO_PRICE
                        }
                    }
                    // let i = e.target.dataset.color;
                    // console.log('111111')
                    // this.proPrice = this.products[i].PRO_PRICE

                },
                goPic(e) {
                    let boxImg = document.getElementById('box_img')
                    // console.log(boxImg.src)
                    // console.log(e.target.src)
                    boxImg.src = e.target.src
                    // boxImg.src = this.
                },
                passcomment(e){
            
                    
                    //將資料放入物件中
                    let commentInfo = {
                        SER_NO: 1,
                        MEM_NO: 1,
                        MES_DATE: 2020,
                        mesText: document.getElementById('procomment').value,

                    };

                    let str = JSON.stringify(commentInfo); //signUpInfo轉成JSON格式字串
                    console.log(str);

                    // let comment = document.getElementById('procomment');
                    // let xhr2 =new XMLHttpRequest();
                    // xhr2.onload = function () {
                    //     if (xhr2.status == 200) {
                           
                    //     }else{
                            
                    //     }
                    // }
                    // xhr2.open("post", "./php/comment.php", true);
                    // xhr2.setRequestHeader("content-type", "application/x-www-form-urlencoded");

                    // let data = `commentInfo=${str}`; //將JSON格式字串儲存進陣列中
                    // xhr2.send(data); //傳遞JSON至PHP

                    //將登入表單上的資料清空，並隱藏起來
                    // document.getElementById('procomment').value = '';                    
                }
                
            },
            beforeUpdate() {
                while(this.products.length < 8){
                    this.products.push('');
                    }
    

            },
            computed: {
                totalPrice(){
                    return this.proPrice*this.proNum;
                },
                // proImgs() {
                    
                //     return this.products[0].PRO_IMGS.split("|")
                // }
                
            },
            // computed: {
            //     proPrice (){
            //         return this.products[0].PRO_PRICE
            //     }
            // },
            
            
                
            mounted() { //在VUE未渲染時執行函數  
              let ser = localStorage.getItem('seriesname')
              console.log(ser)
              
              var xhr = new XMLHttpRequest();
            xhr.onload = function (){
                if( xhr.status == 200 ){ //連線成功
                    app.$data.products = JSON.parse(xhr.responseText); //將導出的物件存入data中
                    app.$data.proPrice = app.$data.products[0].PRO_PRICE //給預設第一項商品單價
                    app.$data.proNum = 1 //給預設第一項商品數量
                    app.$data.selected = app.$data.products[0].PRO_COLOR //給預設第一項商品色票
                    app.$data.proImgs = app.$data.products[0].PRO_IMGS.split("|")
                }else{
                    alert( xhr.status );
                }
                
              }
              var url = "./php/poduct.php?SER_NO="+ser; //設定PHP位置
                xhr.open("get", url, true);
                xhr.send( null );  

                // fetch(url).then(rs => rs.json).then((res)=>{
                    
                // })
                var xhr1 = new XMLHttpRequest();
                xhr1.onload = function (){
                    if( xhr1.status == 200 ){ //連線成功
                        app.$data.proMessage = JSON.parse(xhr1.responseText);
                    }else{
                        alert( xhr1.status );
                    }
                
                }
                var url1 = "./php/message.php";
                xhr1.open("get", url1, true);
                xhr1.send( null );
            }
        });
        
    </script>
    
</body>
</html>