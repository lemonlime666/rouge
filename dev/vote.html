<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
    <link rel="shortcut icon" href="./images/R.ico" />
    <title>ROUGE</title>
    <link rel="stylesheet" href="./css/vote.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/dingli.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js"></script>
</head>
<body >

   
  
    @@include("./app/header_black.html")
    <div id="id01" class="modal">
        <form class="modal-content animate"  method="post">
          <div class="container">
              <h1>歡迎參加票選大賽</h1>
              <div class="showImg">
                <img id="joinImg" src="" alt="">
                <div class="imgContext">
                    <h2>設計理念</h2>
                     <textarea id="design"></textarea>
                     <div class="btnBox">
                        <button type="button" onclick="document.getElementById('id01').style.display='none'" class="btn2-1">放棄參加</button>
                        <button type="button" onclick="joinSend()" class="btn3-1">馬上參加</button>
                    </div>
                </div>
 
              </div>
          </div>
        </form>
      </div>
    <!-- 投票燈箱 -->
    <div id="id02" class="modal2">
        <form class="modal-content2 animate"  method="post">
          <div class="container">
              <p>確定要送出你寶貴的一票嗎</p>
              <div>
                  <button type="button" onclick="document.getElementById('id02').style.display='none'" class="btn2-1">放棄投票</button>
                  <!-- <button type="button" onclick="window.location='./vote.html'"class="btn3-1">馬上參加</button> -->
                  <button type="button" onclick="sendVote()"class="btn3-1">送出投票</button>
              </div>
          </div>
        </form>
      </div>
    <div style="background-color: #292929; height: 100px;width: 100%;"></div>

    <div id="id03" class="modal3">
        <form class="modal-content3 animate" >
          <div class="container">
              <p>本次投票 參加人數不足~~!</p>

              <p>歡迎踴躍參加~~!</p>

              <p>將前往會員頁面確認明信片資料~~!</p>
              <div>
                  <button type="button" onclick="window.location='./memPage.html'"  class="btn3-1">前往會員頁面</button>
              </div>
          </div>
        </form>
      </div>
    <div style="background-color: #292929; height: 100px;width: 100%;"></div>

    <body >
<div id="content"> 


        <div class="firstscreen" style="background-color: #292929;">
            <div class="vTH"><p class="vTH1">明信片票選</p><p class="vTH2">TOP3</p></div>
            <div class="Bgi">
                <img src="./image/voteBgi.svg" >
            </div>
            <div class="top3">
                    <div class="box">
                        <!-- 用來墊 -->
                    </div>
                    <div class="top">
                            <div class="no2">
                                    <img :src="topThree[1].CARD_URL" alt="">
                                    <div class="no">第二名</div>
                                    <div class="tno">{{topThree[1].CARD_VOTESUM}}票</div>
                                </div>
    
                                <div class="no1">
                                    <img :src="topThree[0].CARD_URL" alt="">
                                    <div class="sno1">第一名</div>
                                    <div class="tno1">{{topThree[0].CARD_VOTESUM}}票</div>
                                </div>
       
                       
                                <div class="no3">
                                    <img :src="topThree[2].CARD_URL" alt="">
                                    <div class="no">第三名</div>
                                    <div class="tno">{{topThree[2].CARD_VOTESUM}}票</div>
                                 </div>
                 
                            <div class="invote">
                                <!-- <button class="btn1-1" onclick="document.getElementById('id01').style.display='block'">馬上參加投票</button> -->
                                <button class="btn1-1" @click="joinVote">馬上參加投票</button>
                            </div>
                    </div>


            </div>
        </div>
        <div class="Vcocant">
            <img src="./image/silogan.svg" alt="">
            <div class="vTHA"><p class="vTH3">JUN.</p><p class="vTH4">票選作品</p></div>
        </div>


        <div class="showCards">
            <!-- 背景動態 CANVAS -->
            <canvas id="canv" width="1903" height="513" style="position: absolute; left: 0px; top: 0px;"></canvas>
            <div class="showCard">
            <!-- <div class="showCard" id="content"> -->
                <!-- <img src="./image/top.jpg" alt=""> -->
                 <!-- 翻轉 -->
                <div class="postCardShow"  v-for="(item, index) in showCards">
                    <div class="flip-card">
                        <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <img :src="item.CARD_URL">
                        </div>
                        <div class="flip-card-back">
                            <h1>設計理念</h1> 
                            <p>{{item.CARD_INF}}</p> 
                            <h3>目前票數:{{item.CARD_VOTESUM}} 票</h3>
                            <button class="margincenter btn3-1" :id="item.CARD_NO" @click="vote">點我投票</button>
                        </div>
                        </div>
                    </div>
                </div>
        
            
                 <!-- 翻轉 -->
                 <!-- <div class="postCardShow">
                    <div class="flip-card">
                        <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <img src="./image/top.jpg">
                        </div>
                        <div class="flip-card-back">
                            <h1>設計理念</h1> 
                            <p>利用各種不一樣的配件將自己臉上的美更加展現綻放!</p> 
                            <h2>會員名稱:XXXX</h2>
                            <h3>目前票數:135 票</h3>
                            <button class="btn3-1">點我投票</button>
                        </div>
                        </div>
                    </div>
                </div>   -->
            </div>

        </div>
    </div>

   

   <script>
    // Get the modal
    var modal = document.getElementById('id01');

    // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        function sendVote(){
                let getCardNo= localStorage.getItem('cardNo');
                // alert(getCardNo);
                let xhr = new XMLHttpRequest();
                xhr.onload = function (){
                    if( xhr.status == 200 ){ //連線成功
                        if(xhr.responseText.replace(/\r\n|\n/g,"") =="未登入"){
                            alert("請先登入會員");
                        }else{
                            alert(xhr.responseText);
                            window.location.assign(window.location.href);

                        }
          
          
                    
                    }else{ 
                        alert( xhr.status );
                    }
                    
                }
                var url = "./php/vote.php?cardNo="+getCardNo; //設定PHP位置
                    xhr.open("get", url, true);
                    xhr.send( null );  

            }
        
        function joinSend(){
     
          

            let str= document.getElementById("design").value;
                // alert(str);
                let xhr3 = new XMLHttpRequest();
                xhr3.onload = function (){
                    if( xhr3.status == 200 ){ //連線成功
                
                    alert(xhr3.responseText);
                    window.location.assign(window.location.href);
                    document.getElementById('id01').style.display='none'
                    
                    }else{ 
                        alert( xhr3.status );
                        window.location.assign(window.location.href);
                        document.getElementById('id01').style.display='none'
                    }
                    
                }
               
                var url = "./php/joinSend.php"; //設定PHP位置
                xhr3.open("post", url, true);
                xhr3.setRequestHeader("content-type", "application/x-www-form-urlencoded");
                let procom = `sendText=`+str; //將JSON格式字串儲存進陣列中
                xhr3.send(procom); //傳遞JSON至PHP

              
                
        };

   


        const app = new Vue({
            el: '#content',
            data: {
                //CARD_NO, CARD_URL, MAKEUP_NO,CARD_INF, CARD_VOTESUM, CARD_VOTEDATE
                showCards: [],
                topThree:[],
                member_img:'',
                CARD_NO: '',
                CARD_URL: '', //圖片
                CARD_INF: '', //設計理念
                CARD_VOTESUM: '', //投票數輛
                CARD_VOTEDATE:'', //參加日期
  
            },
            methods: {
                vote(e){
                    document.getElementById('id02').style.display='block';
                    localStorage['cardNo']=e.target.id
                     let cardNO = localStorage.getItem('cardNO')
                    //  console.log(cardNO)
                },
                joinVote(){
                      
                    if(this.member_img.replace(/\r\n|\n/g,"")=="未登入會員"){
                        alert("請先登入會員");
                    }else if(this.member_img.replace(/\r\n|\n/g,"")=="尚未有明信片資料"){
                        alert("尚未有明信片資料,請前往試妝!");
                        location.href='./makeUp.html';
                    }else{
                        console.log(this.member_img);
                        document.getElementById('id01').style.display='block';
                        document.getElementById('joinImg').src = this.member_img;
                    }
                },


                },
            computed: {
         
     
            },
        
            
                
            mounted() { //在VUE未渲染時執行函數  
            //   let ser = localStorage.getItem('seriesname')
            //   console.log(ser)
             
            
            //拉下方投票卡片
            var xhr = new XMLHttpRequest();
            xhr.onload = function (){
                if( xhr.status == 200 ){ //連線成功

                    if(xhr.responseText.replace(/\r\n|\n/g,"") == "查無資料"){
                        // alert("查無資料");
                        document.getElementById('id03').style.display='block';
                    }else{
                        app.$data.showCards = JSON.parse(xhr.responseText); //將導出的物件存入data中
                   console.log(app.$data.showCards);
        
                    }
   
                
                }else{ 
                    alert( xhr.status );
                }
                
              }
              var url = "./php/showVoteCard.php"; //設定PHP位置
                xhr.open("get", url, true);
                xhr.send( null );  


            //拉前三 跟會員明信片圖片 然後練習在前端切割
            var xhr2 = new XMLHttpRequest();
            xhr2.onload = function (){
             if( xhr2.status == 200 ){ //連線成功
                    // app.$data.topThree = JSON.parse(xhr2.responseText); //將導出的物件存入data中
                    console.log(xhr2.responseText);
                    let strarr = xhr2.responseText.split("|");
                   app.$data.member_img= strarr[0].replace(/\r\n|\n/g,"") ;
                   if(strarr[1].replace(/\r\n|\n/g,"") == "查無資料" ){

                        // alert("查無資料");
                        document.getElementById('id03').style.display='block';
                    }else{
                        
                   app.$data.topThree=JSON.parse(strarr[1]);

                    }

                    console.log(strarr);
                 

                }else{ 
                    alert( xhr2.status );
                }
                
              }
              var url = "./php/topThree.php"; //設定PHP位置
                xhr2.open("get", url, true);
                xhr2.send( null );  

            }
         
        });
          

 
   </script>

<script>
    $(".showCards").ready(function(){

        
    })
    window.onload = function() {
        
    window.requestAnimFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 1000 / 60);
          
        };
      
    })();
    var c = document.getElementById('canv');
    var $ = c.getContext('2d');
    var w = c.width = window.innerWidth;
    var h = c.height = document.getElementsByClassName("showCards")[0].offsetHeight;
    var _w = w * 0.5;
    var _h = h * 0.5;
     var arr = [];
    var cnt = 0;
    
    window.addEventListener('load', resize);
    window.addEventListener('resize', resize, false);
    
    function resize() {
      c.width = w = window.innerWidth;
      c.height = h = document.getElementsByClassName("showCards")[0].offsetHeight;
      c.style.position = 'absolute';
      c.style.left = (window.innerWidth - w) *
        .01 + 'px';
      c.style.top = (document.getElementsByClassName("showCards")[0].offsetHeight - h) *
        .01 + 'px';
    }
    
    function anim() {
      cnt++;
      if (cnt % 6) draw();
      window.requestAnimFrame(anim);
     
    }
    anim();
    
    function draw() {
    
      var splot = {
        x: rng(_w - 900, _w + 900),
        y: rng(_h - 900, _h + 900),
        r: rng(20, 80),
        spX: rng(-1, 1),
        spY: rng(-1, 1)
      };
    
      arr.push(splot);
      while (arr.length > 100) {
        arr.shift();
      }
      $.clearRect(0, 0, w, h);
    
      for (var i = 0; i < arr.length; i++) {
    
        splot = arr[i];;
        $.fillStyle = rndCol();
        $.beginPath();
        $.arc(splot.x, splot.y, splot.r, 0, Math.PI * 2, true);
        $.shadowBlur = 80;
        $.shadowOffsetX = 2;
        $.shadowOffsetY = 2;
        $.shadowColor = rndCol();
        $.globalCompositeOperation = 'lighter';
        $.fill();
    
        splot.x = splot.x + splot.spX;
        splot.y = splot.y + splot.spY;
        splot.r = splot.r * 0.96;
      }
    }
    
    function rndCol() {
      var r = Math.floor(Math.random() * 180);
      var g = Math.floor(Math.random() * 60);
      var b = Math.floor(Math.random() * 100);
      return "rgb(" + r + "," + g + "," + b + ")";
    }
    
    function rng(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    }
  


    </script>


    <script src="./js/header.js"></script>
    
        
</body>
</html>