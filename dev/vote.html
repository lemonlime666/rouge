<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投票</title>
    <link rel="stylesheet" href="./css/vote.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" ></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/dingli.css">

   <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js"></script>
</head>
<body >

   
  
    @@include("./app/header_black.html")
    <div id="id01" class="modal">
        <form class="modal-content animate"  method="post">
          <div class="container">
              <h1>歡迎參加票選大賽</h1>
              <div class="showImg">
                <img id="joinImg" src="" alt="">
                <div class="imgContext">
                    <h2>設計理念</h2>
                     <textarea id="design"></textarea>
                     <div class="btnBox">
                        <button type="button" onclick="document.getElementById('id01').style.display='none'" class="btn2-1">放棄參加</button>
                        <button type="button" onclick="joinSend()" class="btn3-1">馬上參加</button>
                    </div>
                </div>
 
              </div>
          </div>
        </form>
      </div>
    <!-- 投票燈箱 -->
    <div id="id02" class="modal2">
        <form class="modal-content2 animate"  method="post">
          <div class="container">
              <p>確定要送出你寶貴的一票嗎</p>
              <div>
                  <button type="button" onclick="document.getElementById('id02').style.display='none'" class="btn2-1">放棄投票</button>
                  <!-- <button type="button" onclick="window.location='./vote.html'"class="btn3-1">馬上參加</button> -->
                  <button type="button" onclick="sendVote()"class="btn3-1">送出投票</button>
              </div>
          </div>
        </form>
      </div>
    <div style="background-color: #292929; height: 100px;width: 100%;"></div>
    <body >
<div id="content"> 


        <div class="firstscreen" style="background-color: #292929;">
            <div class="vTH"><p class="vTH1">明信片票選</p><p class="vTH2">TOP3</p></div>
            <div class="Bgi">
                <img src="./image/voteBgi.svg" >
            </div>
            <div class="top3">
                    <div class="box">
                        <!-- 用來墊 -->
                    </div>
                    <div class="top">
                            <div class="no2">
                                    <img :src="topThree[1].CARD_URL" alt="">
                                    <div class="no">第二名</div>
                                    <div class="tno">{{topThree[1].CARD_VOTESUM}}票</div>
                                </div>
    
                                <div class="no1">
                                    <img :src="topThree[0].CARD_URL" alt="">
                                    <div class="sno1">第一名</div>
                                    <div class="tno1">{{topThree[0].CARD_VOTESUM}}票</div>
                                </div>
       
                       
                                <div class="no3">
                                    <img :src="topThree[2].CARD_URL" alt="">
                                    <div class="no">第三名</div>
                                    <div class="tno">{{topThree[2].CARD_VOTESUM}}票</div>
                                 </div>
                 
                            <div class="invote">
                                <!-- <button class="btn1-1" onclick="document.getElementById('id01').style.display='block'">馬上參加投票</button> -->
                                <button class="btn1-1" @click="joinVote">馬上參加投票</button>
                            </div>
                    </div>


            </div>
        </div>
        <div class="Vcocant">
            <img src="./image/silogan.svg" alt="">
            <div class="vTHA"><p class="vTH3">JUN.</p><p class="vTH4">票選作品</p></div>
        </div>


        <div class="showCards">
            <div class="showCard">
            <!-- <div class="showCard" id="content"> -->
                <!-- <img src="./image/top.jpg" alt=""> -->
                 <!-- 翻轉 -->
                <div class="postCardShow"  v-for="(item, index) in showCards">
                    <div class="flip-card">
                        <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <img :src="item.CARD_URL">
                        </div>
                        <div class="flip-card-back">
                            <h1>設計理念</h1> 
                            <p>{{item.CARD_INF}}</p> 
                            <h3>目前票數:{{item.CARD_VOTESUM}} 票</h3>
                            <button class="btn3-1" :id="item.CARD_NO" @click="vote">點我投票</button>
                        </div>
                        </div>
                    </div>
                </div>
        
            
                 <!-- 翻轉 -->
                 <!-- <div class="postCardShow">
                    <div class="flip-card">
                        <div class="flip-card-inner">
                        <div class="flip-card-front">
                            <img src="./image/top.jpg">
                        </div>
                        <div class="flip-card-back">
                            <h1>設計理念</h1> 
                            <p>利用各種不一樣的配件將自己臉上的美更加展現綻放!</p> 
                            <h2>會員名稱:XXXX</h2>
                            <h3>目前票數:135 票</h3>
                            <button class="btn3-1">點我投票</button>
                        </div>
                        </div>
                    </div>
                </div>   -->
            </div>

        </div>
    </div>
   <script>

    // Get the modal
    var modal = document.getElementById('id01');

    // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
        function sendVote(){
                let getCardNo= localStorage.getItem('cardNo');
                alert(getCardNo);
                let xhr = new XMLHttpRequest();
                xhr.onload = function (){
                    if( xhr.status == 200 ){ //連線成功
                        if(xhr.responseText ==0 || xhr.responseText=="↵0"){
                            alert("請先登入會員");
                        }else{
                            alert(xhr.responseText);
                        }
          
          
                    
                    }else{ 
                        alert( xhr.status );
                    }
                    
                }
                var url = "./php/vote.php?cardNo="+getCardNo; //設定PHP位置
                    xhr.open("get", url, true);
                    xhr.send( null );  

            }
        
        function joinSend(){
     
          

            let str= document.getElementById("design").value;
                // alert(str);
                let xhr3 = new XMLHttpRequest();
                xhr3.onload = function (){
                    if( xhr3.status == 200 ){ //連線成功
                
                    alert(xhr3.responseText);
                      
                    
                    }else{ 
                        alert( xhr3.status );
                    }
                    
                }
               
                var url = "./php/joinSend.php"; //設定PHP位置
                xhr3.open("post", url, true);
                xhr3.setRequestHeader("content-type", "application/x-www-form-urlencoded");
                let procom = `sendText=`+str; //將JSON格式字串儲存進陣列中
                xhr3.send(procom); //傳遞JSON至PHP


        };

   


        const app = new Vue({
            el: '#content',
            data: {
                //CARD_NO, CARD_URL, MAKEUP_NO,CARD_INF, CARD_VOTESUM, CARD_VOTEDATE
                showCards: [],
                topThree:[],
                member_img:'',
                CARD_NO: '',
                CARD_URL: '', //圖片
                CARD_INF: '', //設計理念
                CARD_VOTESUM: '', //投票數輛
                CARD_VOTEDATE:'', //參加日期
  
            },
            methods: {
                vote(e){
                    document.getElementById('id02').style.display='block';
                    localStorage['cardNo']=e.target.id
                     let cardNO = localStorage.getItem('cardNO')
                    //  console.log(cardNO)
                },
                joinVote(){
                      
                    if(this.member_img=="未登入會員" || this.member_img=="↵未登入會員"){
                        alert("請先登入會員");
                    }else if(this.member_img=="尚未有明信片資料" || this.member_img=="↵尚未有明信片資料" ){
                        alert("尚未有明信片資料,請前往試妝!");
                        location.href='./makeUp.html';
                    }else{
                        document.getElementById('id01').style.display='block';
                        document.getElementById('joinImg').src = this.member_img;
                    }
                },


                },
            computed: {
         
     
            },
        
            
                
            mounted() { //在VUE未渲染時執行函數  
            //   let ser = localStorage.getItem('seriesname')
            //   console.log(ser)
             
            
            //拉下方投票卡片
            var xhr = new XMLHttpRequest();
            xhr.onload = function (){
                if( xhr.status == 200 ){ //連線成功

                    if(xhr.responseText == "查無資料" || xhr.responseText == "↵查無資料" ){
                        alert("查無資料");
                    }else{
                        app.$data.showCards = JSON.parse(xhr.responseText); //將導出的物件存入data中
                   console.log(app.$data.showCards);
        
                    }
   
                
                }else{ 
                    alert( xhr.status );
                }
                
              }
              var url = "./php/showVoteCard.php"; //設定PHP位置
                xhr.open("get", url, true);
                xhr.send( null );  


            //拉前三 跟會員明信片圖片 然後練習在前端切割
            var xhr2 = new XMLHttpRequest();
            xhr2.onload = function (){
             if( xhr2.status == 200 ){ //連線成功
                    // app.$data.topThree = JSON.parse(xhr2.responseText); //將導出的物件存入data中
                   let strarr = xhr2.responseText.split("|");
                   app.$data.member_img=strarr[0];
                   if(strarr[1] == "查無資料" || strarr[1] == "↵查無資料" ){
                        alert("查無資料");
                    }else{
                        
                   app.$data.topThree=JSON.parse(strarr[1]);

                    }

                    console.log(strarr);
                 

                }else{ 
                    alert( xhr2.status );
                }
                
              }
              var url = "./php/topThree.php"; //設定PHP位置
                xhr2.open("get", url, true);
                xhr2.send( null );  

            }
         
        });
          

 
   </script>
    <script src="./js/header.js"></script>
</body>
</html>