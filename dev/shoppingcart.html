<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="./css/shoppingcart.css">
  
  <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&family=Noto+Serif+TC:wght@200;300;400;500;600;700;900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Nunito+Sans:ital,wght@0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./js/main.js"></script>
</head>
<body>
  @@include("./app/header_black.html")
  <div class="shop-main" id="app">
    <div class="title">
      <h2 class="xxlfont">Shoppingcart</h2>
    </div>
    <div class="shop-block" v-if="products.length">
      <div class="pro-total-block">
        <div class="pro-total-title">
          <div class="pro-title">
            產品名稱
          </div>
          <div class="mem-title">
            數量
          </div>
          <div class="price-title">
            價格
          </div>

        </div>
        <!--購物車卡片-->
        <div class="cart-card" v-for="(item, index) in products" v-cloak>
          <div class="cart-pro-pic">
            <div class="cart-pic-img">
              <img :src="item.comImg">
            </div>

          </div>
          <div class="rwd-pro-del">
            <div class="cart-pro-del">
              <div class="cart-name">
                {{item.comName}}

              </div>
              <div class="cart-del">
                <button @click="remove(index)">delete</button>

              </div>

            </div>
            <div class="cart-mem">
              <button @click="decrement(index)" v-bind:disabled="item.comNum <= 1">-</button>
              <div>{{item.comNum}}</div>
              <button @click="increment(index)" :disabled="item.comNum >= 9">+</button>
              
            </div>

          </div>
          
          <div class="cart-price">
            {{item.comPrice*item.comNum | showPrice}}

          </div>

        </div>
        <!-- 贈品卡片 -->
        <div class="cart-card" v-for="item in gifts" if="item.GIF_CONDI  this.totalprice" v-cloak>
          <div class="cart-pro-pic">
            <div class="cart-pic-img">
              <img :src="item.GIF_IMGURL">
            </div>

          </div>
          <div class="rwd-pro-del">
            <div class="cart-pro-del">
              <div class="cart-name gift-name">
                滿額禮:<br>
                {{item.GIF_NAME}}----
               
              </div>
              

            </div>
            <div class="cart-mem">
              
              <div><span>數量 : </span>1</div>
              
            </div>

          </div>
          
          <div class="cart-price">
            免費

          </div>

        </div>
       
        <!--總價-->
        <div class="cart-total-price">
          <div class="cart-total-tit">
            總計
          </div>
          
          <div class="cart-total-mem">
            {{totalprice | showPrice}}
          </div>

        </div>

      </div>
      <!-- 測試 -->
      <!-- <div v-for="item in lastgift">{{item.GIF_NAME}}</div> -->
      <!-- <div class="cart-card" v-for="item in lastgift" v-cloak>
        <div class="cart-pro-pic">
          <div class="cart-pic-img">
            <img :src="item.GIF_IMGURL">
          </div>

        </div>
        <div class="rwd-pro-del">
          <div class="cart-pro-del">
            <div class="cart-name gift-name">
              滿額禮:<br>
              {{item.GIF_NAME}}

            </div>
            

          </div>
          <div class="cart-mem">
            
            <div><span>數量 : </span>1</div>
            
          </div>

        </div>
        
        <div class="cart-price">
          免費

        </div>

      </div> -->
      
      <!--結帳-->
      <div class="check">
        <button>立即結帳</button>
        <button><a href="./light-lips.html">繼續購物</a></button>

      </div>
    </div>
    <h2 v-else>購物車為空</h2>
  </div>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.11/vue.js'></script>
  <script>
    const app = new Vue({
      el: "#app",
      data: {
        products: '',
        gifts:'',
        max: ''
        
        
      },
      methods: {
        remove(index){
          this.products.splice(index, 1);
          localStorage['shoppingcart'] = JSON.stringify(this.products)
          //禮物
          alert();
          for(let i=0; i<this.gifts.length;i++){
            
            if(this.totalprice>this.gifts[i].GIF_CONDI){
            
              this.$data.max = this.gifts[i];
              }   
          }
        },
        decrement(index){
          this.products[index].comNum--;
          localStorage['shoppingcart'] = JSON.stringify(this.products)
        },
        increment(index){
          this.products[index].comNum++;
          localStorage['shoppingcart'] = JSON.stringify(this.products)
        },
        // gogift (){
        //   this.gogift = app.gifts.filter(item => item.GIF_CONDI > app.totalprice)
        // }


        lastgift() {
          alert();
          for(let i=0; i<this.gifts.length;i++){
            
            if(this.totalprice>this.gifts[i].GIF_CONDI){
            
              this.$data.max = this.gifts[i];
              }             
          }
          // return this.gifts.filter(item =>  item.GIF_CONDI < this.totalprice)
        }
      },
      computed: {
        totalprice(){
          let totalprice = 0;
          for(item of this.products){
            totalprice += item.comPrice*item.comNum;
          }
          return totalprice;
        },
        
        // lastgift() {
        //   for(let i=0; i<this.gifts.length;i++){
        //     let max={};
        //     if(this.totalprice>this.gifts[i].GIF_CONDI){
        //       max = this.gifts[i];
        //       }             
        //   }
        //   return max;
        //   // return this.gifts.filter(item =>  item.GIF_CONDI < this.totalprice)
        // }
        

      },
      watch: {
        
        
      },
      filters: {
        showPrice(price){
          return 'NT$' + price;
        }
      },
      created() {
        this.products = JSON.parse(localStorage.getItem('shoppingcart')) //抓取localstorage中的購物車字串並轉為物件
        var xhr = new XMLHttpRequest();
        xhr.onload = function (){
          if( xhr.status == 200){
            
            app.$data.gifts = JSON.parse(xhr.responseText);
            
          }else{
            alert(xhr.status)
          }
        }
        var url = "./php/shoppingcart.php";
        xhr.open("get", url, true);
        xhr.send(null);
        
      },
      mounted() {
        // this.products = localStorage.getItem('shoppingcart')
        


        

        this.products = JSON.parse(localStorage.getItem('shoppingcart')) //抓取localstorage中的購物車字串並轉為物件

        

      },


    })
  </script>
</body>
</html>